/* Copyright (C) YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

(function(e){var d=function(){};d.prototype=e.extend(d.prototype,{name:"Update",options:{msgPerformingUpdate:"Performing Update...",msgFinished:"Update successfull...Reload page to continue working.",msgError:"Error during update. Please visit the YOOtheme support forums."},initialize:function(b,a){this.options=e.extend({},this.options,a);var c=this;this.form=b;b.find("button.update").bind("click",function(){e(this).parent().remove();c.step()})},step:function(){var b=this.form,a=this;e.ajax({url:b.attr("action"),
type:"post",datatype:"json",data:b.serialize(),beforeSend:function(){a.addMessage(a.options.msgPerformingUpdate,"loading")},success:function(c){try{c=e.parseJSON(c)}catch(d){c=e.parseJSON('{"error":"true", "message":"'+d.replace(/"/g,"'")+'"}')}b.find("div.message-box").find("div.message").last().removeClass("loading");c.error?a.addMessage(c.message,"error"):(a.addMessage(c.message),c["continue"]?a.step():(a.addMessage(a.options.msgFinished,"success"),b.find("button.update").removeEvents()))},error:function(c,
d){b.find("div.message-box").find("div.message").last().removeClass("loading");a.addMessage(d,"error")}})},addMessage:function(b,a){b=e('<div class="message">').text(b).appendTo(this.form.find("div.message-box"));a&&b.addClass(a)}});e.fn[d.prototype.name]=function(){var b=arguments,a=b[0]?b[0]:null;return this.each(function(){var c=e(this);if(d.prototype[a]&&c.data(d.prototype.name)&&a!="initialize")c.data(d.prototype.name)[a].apply(c.data(d.prototype.name),Array.prototype.slice.call(b,1));else if(!a||
e.isPlainObject(a)){var f=new d;d.prototype.initialize&&f.initialize.apply(f,e.merge([c],b));c.data(d.prototype.name,f)}else e.error("Method "+a+" does not exist on jQuery."+d.name)})}})(jQuery);
